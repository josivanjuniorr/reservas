<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Reservas Hotel Padre CÃ­cero</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="auth.css">
</head>
<body>

<!-- Tela de Login -->
<div id="loginScreen" style="display:none;">
  <div class="login-container">
    <div class="login-header">
      <div class="login-logo">PC</div>
      <h2>Hotel Padre CÃ­cero</h2>
      <p>Sistema de GestÃ£o de Reservas</p>
    </div>
    
    <div class="login-body">
      <!-- FormulÃ¡rio de Login -->
      <div id="loginForm" class="login-form">
        <div class="error-message" id="loginError"></div>
        
        <div class="form-group">
          <label>ğŸ“§ Email</label>
          <input type="email" id="loginEmail" placeholder="seu@email.com" required autocomplete="email">
        </div>
        
        <div class="form-group">
          <label>ğŸ”’ Senha</label>
          <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required autocomplete="current-password">
        </div>
        
        <button type="button" onclick="handleLogin()" class="btn-primary">ğŸ”“ Entrar</button>
        
        <div class="divider">OU</div>
        
        <button type="button" onclick="Auth.toggleMode()" class="btn-secondary">
          âœ¨ Criar nova conta
        </button>
      </div>
      
      <!-- FormulÃ¡rio de Cadastro -->
      <div id="signupForm" class="login-form" style="display:none;">
        <div class="error-message" id="signupError"></div>
        <div class="success-message" id="signupSuccess"></div>
        
        <div class="form-group">
          <label>ğŸ‘¤ Nome Completo</label>
          <input type="text" id="signupName" placeholder="Seu nome completo" required autocomplete="name">
        </div>
        
        <div class="form-group">
          <label>ğŸ“§ Email</label>
          <input type="email" id="signupEmail" placeholder="seu@email.com" required autocomplete="email">
        </div>
        
        <div class="form-group">
          <label>ğŸ”’ Senha</label>
          <input type="password" id="signupPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required autocomplete="new-password" minlength="6">
          <small style="color:var(--muted);font-size:12px">MÃ­nimo 6 caracteres</small>
        </div>
        
        <button type="button" onclick="handleSignup()" class="btn-primary">ğŸ‰ Criar Conta</button>
        
        <div class="divider">OU</div>
        
        <button type="button" onclick="Auth.toggleMode()" class="btn-secondary">
          ğŸ”™ Voltar ao login
        </button>
      </div>
    </div>
  </div>
</div>

<!-- AplicaÃ§Ã£o Principal -->
<div id="appScreen" style="display:none;">
<div class="wrap">
<header>
  <div class="brand">
    <div class="logo">PC</div>
    <div>
      <h1>Hotel Padre CÃ­cero</h1>
      <p class="lead">Sistema de GestÃ£o de Reservas</p>
    </div>
  </div>
  <div id="userInfo"></div>
</header>

<main class="grid">
<!-- ESQUERDA -->
<section class="card">
<h2>Nova Reserva</h2>
<form id="reservationForm">
  <div class="row">
    <div style="flex:1">
      <label>ğŸ‘¤ Nome do HÃ³spede</label>
      <input type="text" id="guestName" required placeholder="Digite o nome completo" autocomplete="name">
    </div>
    <div style="width:150px">
      <label>ğŸ“ Telefone</label>
      <input type="tel" id="phone" placeholder="(00) 00000-0000" autocomplete="tel">
    </div>
  </div>
  <div class="row">
    <div style="flex:1">
      <label>ğŸ¨ Tipo de Quarto</label>
      <select id="roomType"></select>
    </div>
    <div style="width:120px">
      <label>ğŸ”¢ Qtd</label>
      <select><option>1 apto</option></select>
    </div>
  </div>
  <div class="row">
    <div style="flex:1">
      <label>ğŸ“… Data de Entrada</label>
      <input type="date" id="startDate" required>
    </div>
    <div style="flex:1">
      <label>ğŸ“… Data de SaÃ­da</label>
      <input type="date" id="endDate" required>
    </div>
  </div>
  <div class="row">
    <div style="flex:1">
      <label>ğŸ‘” ResponsÃ¡vel</label>
      <input type="text" id="responsible" placeholder="Nome do responsÃ¡vel" autocomplete="name">
    </div>
    <div style="width:150px">
      <label>ğŸ’° Valor (R$)</label>
      <input type="number" id="price" step="0.01" min="0" placeholder="0,00">
    </div>
  </div>
  <div class="row">
    <div style="flex:1">
      <label>ğŸ“ ObservaÃ§Ãµes</label>
      <textarea id="notes" placeholder="InformaÃ§Ãµes adicionais sobre a reserva..."></textarea>
    </div>
  </div>
  <div style="display:flex;gap:12px;margin-top:16px">
    <button class="btn" type="submit">âœ… Confirmar Reserva</button>
    <button class="btn ghost" type="button" id="clearForm">ğŸ”„ Limpar</button>
  </div>
  <div id="formMsg"></div>

  <hr style="margin:24px 0;border:0;border-top:2px solid var(--border);opacity:0.5">
  <h3 style="color:var(--accent);margin-bottom:12px;font-size:18px">ğŸ“Š Consultar Disponibilidade</h3>
  <p style="color:var(--muted);margin-bottom:12px;font-size:14px">Veja quantos apartamentos estarÃ£o disponÃ­veis em uma data futura:</p>
  <input type="date" id="queryDate" style="padding:12px 16px;width:100%;max-width:250px;border:2px solid var(--border);border-radius:10px">
  <div id="futureSummary" class="availability-container"></div>
</form>
</section>

<!-- DIREITA -->
<section class="card">
<h2>ğŸ“‹ Gerenciar Reservas</h2>
<div class="tab-buttons">
  <button id="tabCurrent" class="active">ğŸ“… Atuais e Futuras</button>
  <button id="tabHistory">ğŸ• HistÃ³rico</button>
</div>
<div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:16px">
  <div class="search-box" style="flex:1;min-width:200px">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <input type="text" id="searchInput" placeholder="Buscar por nome do hÃ³spede...">
  </div>
  <select id="filterType" style="padding:12px 16px;border:2px solid var(--border);border-radius:10px;font-size:14px"><option value="all">ğŸ¨ Todos os tipos</option></select>
</div>
<div id="reservationsList" style="margin-top:12px;"></div>
<div id="historyList" style="margin-top:12px;"></div>
</section>
</main>
</div>

<!-- Modal de ediÃ§Ã£o -->
<div id="editModal">
  <div class="card">
    <h2>âœï¸ Editar Reserva</h2>
    <form id="editForm">
      <div style="margin-bottom:12px">
        <label>ğŸ‘¤ Nome do HÃ³spede</label>
        <input type="text" id="editName" required>
      </div>
      <div style="margin-bottom:12px">
        <label>ğŸ“ Telefone</label>
        <input type="text" id="editPhone">
      </div>
      <div style="margin-bottom:12px">
        <label>ğŸ¨ Tipo de Quarto</label>
        <select id="editRoomType"></select>
      </div>
      <div style="display:flex;gap:12px;margin-bottom:12px">
        <div style="flex:1">
          <label>ğŸ“… Entrada</label>
          <input type="date" id="editStartDate" required>
        </div>
        <div style="flex:1">
          <label>ğŸ“… SaÃ­da</label>
          <input type="date" id="editEndDate" required>
        </div>
      </div>
      <div style="margin-bottom:12px">
        <label>ğŸ‘” ResponsÃ¡vel</label>
        <input type="text" id="editResponsible">
      </div>
      <div style="margin-bottom:12px">
        <label>ğŸ’° Valor (R$)</label>
        <input type="number" id="editPrice" step="0.01" min="0">
      </div>
      <div style="margin-bottom:12px">
        <label>ğŸ“ ObservaÃ§Ãµes</label>
        <textarea id="editNotes"></textarea>
      </div>
      <div style="margin-bottom:16px;display:flex;align-items:center;gap:10px">
        <input type="checkbox" id="editOnClipboard" style="width:auto;margin:0">
        <label style="margin:0">ğŸ“‹ Marcar na prancheta</label>
      </div>
      <div style="display:flex;gap:12px">
        <button class="btn" type="submit">ğŸ’¾ Salvar AlteraÃ§Ãµes</button>
        <button type="button" class="btn ghost" onclick="closeEditModal()">âŒ Cancelar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de HistÃ³rico -->
<div id="historyModal" style="display:none;">
  <div class="card" style="max-width:700px;width:100%;max-height:80vh;overflow-y:auto;">
    <h2>ğŸ“œ HistÃ³rico de AlteraÃ§Ãµes</h2>
    <div id="historyContent"></div>
    <button type="button" class="btn ghost" onclick="closeHistoryModal()" style="margin-top:20px;width:100%">
      âœ–ï¸ Fechar
    </button>
  </div>
</div>

</div>
<!-- Fim do appScreen -->

<!-- Load config FIRST (synchronously) so SUPABASE_CONFIG is available before other scripts -->
<script src="config.js"></script>
<script src="config.example.js"></script> <!-- Fallback for GitHub Pages -->

<!-- Supabase JS (UMD) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
<script src="supabase-integration.js"></script>
<script src="auth.js"></script>
<script src="app.js"></script>

<script>
// Handlers de Login
async function handleLogin() {
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  const errorDiv = document.getElementById('loginError');
  
  if (!email || !password) {
    errorDiv.textContent = 'âŒ Preencha todos os campos';
    errorDiv.classList.add('show');
    return;
  }
  
  errorDiv.classList.remove('show');
  
  const result = await Auth.login(email, password);
  
  if (!result.success) {
    errorDiv.textContent = 'âŒ ' + (result.error || 'Erro ao fazer login');
    errorDiv.classList.add('show');
  }
}

async function handleSignup() {
  const name = document.getElementById('signupName').value.trim();
  const email = document.getElementById('signupEmail').value.trim();
  const password = document.getElementById('signupPassword').value;
  const errorDiv = document.getElementById('signupError');
  const successDiv = document.getElementById('signupSuccess');
  
  errorDiv.classList.remove('show');
  successDiv.classList.remove('show');
  
  if (!name || !email || !password) {
    errorDiv.textContent = 'âŒ Preencha todos os campos';
    errorDiv.classList.add('show');
    return;
  }
  
  if (password.length < 6) {
    errorDiv.textContent = 'âŒ A senha deve ter no mÃ­nimo 6 caracteres';
    errorDiv.classList.add('show');
    return;
  }
  
  const result = await Auth.signup(email, password, name);
  
  if (result.success) {
    if (result.needsConfirmation) {
      successDiv.textContent = 'âœ… ' + result.message;
      successDiv.classList.add('show');
    }
  } else {
    errorDiv.textContent = 'âŒ ' + (result.error || 'Erro ao criar conta');
    errorDiv.classList.add('show');
  }
}

// Permitir login com Enter
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('loginEmail')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') document.getElementById('loginPassword').focus();
  });
  
  document.getElementById('loginPassword')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') handleLogin();
  });
  
  document.getElementById('signupPassword')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') handleSignup();
  });
});
</script>

</body>
</html>
